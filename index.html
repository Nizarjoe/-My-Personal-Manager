<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Personal Assistant - Super Ringan</title>

    <!-- External Libraries via CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        /* Light Theme */
        --bg-primary: #ffffff;
        --bg-secondary: #f8f9fa;
        --text-primary: #212529;
        --text-secondary: #6c757d;
        --accent-primary: #007bff;
        --accent-success: #28a745;
        --accent-danger: #dc3545;
        --accent-warning: #ffc107;
        --border-color: #dee2e6;
        --shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      [data-theme="dark"] {
        /* Dark Theme */
        --bg-primary: #1a1a1a;
        --bg-secondary: #2d2d2d;
        --text-primary: #ffffff;
        --text-secondary: #cccccc;
        --accent-primary: #0d6efd;
        --accent-success: #198754;
        --accent-danger: #dc3545;
        --accent-warning: #ffc107;
        --border-color: #495057;
        --shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        background: var(--bg-primary);
        color: var(--text-primary);
        font-size: 16px;
        line-height: 1.6;
        transition: all 0.3s ease;
        min-height: 100vh;
      }

      /* LOGIN SCREEN */
      .login-container {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 20px;
      }

      .login-card {
        background: var(--bg-primary);
        padding: 40px;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        text-align: center;
        width: 100%;
        max-width: 420px;
        backdrop-filter: blur(10px);
      }

      .logo {
        width: 100px;
        height: 100px;
        margin: 0 auto 20px;
        background: linear-gradient(
          135deg,
          var(--accent-primary),
          var(--accent-success)
        );
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 40px;
        color: white;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      .login-title {
        font-size: 28px;
        margin-bottom: 30px;
        color: var(--text-primary);
        font-weight: 700;
      }

      .form-group {
        margin-bottom: 25px;
        text-align: left;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: var(--text-primary);
        font-size: 16px;
      }

      .form-control {
        width: 100%;
        padding: 15px 20px;
        border: 2px solid var(--border-color);
        border-radius: 12px;
        font-size: 16px;
        background: var(--bg-secondary);
        color: var(--text-primary);
        transition: all 0.3s ease;
        outline: none;
      }

      .form-control:focus {
        border-color: var(--accent-primary);
        box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        transform: translateY(-2px);
      }

      .btn {
        padding: 15px 30px;
        border: none;
        border-radius: 12px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-block;
        text-align: center;
        position: relative;
        overflow: hidden;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      }

      .btn:active {
        transform: translateY(0);
      }

      .btn-primary {
        background: linear-gradient(135deg, var(--accent-primary), #0056b3);
        color: white;
        width: 100%;
      }

      .btn-success {
        background: linear-gradient(135deg, var(--accent-success), #1e7e34);
        color: white;
      }

      .btn-danger {
        background: linear-gradient(135deg, var(--accent-danger), #c82333);
        color: white;
      }

      .btn-warning {
        background: linear-gradient(135deg, var(--accent-warning), #e0a800);
        color: #212529;
      }

      .btn-small {
        padding: 8px 16px;
        font-size: 14px;
      }

      .error-message {
        background: linear-gradient(135deg, var(--accent-danger), #c82333);
        color: white;
        padding: 20px;
        border-radius: 12px;
        margin: 20px 0;
        font-size: 18px;
        font-weight: 600;
        animation: shake 0.5s ease-in-out;
        box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
      }

      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-5px);
        }
        75% {
          transform: translateX(5px);
        }
      }

      /* MAIN APP */

      .header {
        background: var(--bg-secondary);
        padding: 20px 30px;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        position: sticky;
        top: 0;
        z-index: 100;
        backdrop-filter: blur(10px);
      }

      .header-title {
        font-size: 24px;
        font-weight: 700;
        color: var(--text-primary);
      }

      .header-controls {
        display: flex;
        gap: 15px;
        align-items: center;
      }

      .theme-toggle {
        background: var(--accent-primary);
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        transition: all 0.3s ease;
      }

      .theme-toggle:hover {
        transform: scale(1.05);
      }

      .sidebar {
        width: 280px;
        background: var(--bg-secondary);
        height: calc(100vh - 80px);
        position: fixed;
        left: 0;
        top: 80px;
        border-right: 1px solid var(--border-color);
        overflow-y: auto;
        z-index: 50;
        transition: transform 0.3s ease;
      }

      .sidebar-menu {
        list-style: none;
        padding: 30px 0;
      }

      .sidebar-menu li {
        padding: 0;
        margin: 5px 0;
      }

      .sidebar-menu a {
        display: flex;
        align-items: center;
        padding: 18px 25px;
        color: var(--text-primary);
        text-decoration: none;
        font-size: 16px;
        font-weight: 500;
        transition: all 0.3s ease;
        border-radius: 0 25px 25px 0;
        margin-right: 20px;
      }

      .sidebar-menu a:hover {
        background: var(--accent-primary);
        color: white;
        transform: translateX(10px);
      }

      .sidebar-menu a.active {
        background: var(--accent-primary);
        color: white;
        box-shadow: 0 5px 15px rgba(0, 123, 255, 0.3);
      }

      .sidebar-menu a .icon {
        margin-right: 15px;
        font-size: 18px;
      }

      .content-section {
        display: none;
        animation: fadeIn 0.5s ease-in-out;
      }

      .content-section.active {
        display: block;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .card {
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: 16px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: var(--shadow);
        transition: all 0.3s ease;
      }

      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
      }

      .card-title {
        font-size: 22px;
        font-weight: 700;
        margin-bottom: 25px;
        color: var(--text-primary);
        border-bottom: 2px solid var(--accent-primary);
        padding-bottom: 10px;
      }

      .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 25px;
        margin-bottom: 40px;
      }

      .stat-card {
        background: linear-gradient(
          135deg,
          var(--accent-primary),
          var(--accent-success)
        );
        color: white;
        text-align: center;
        border-radius: 16px;
        padding: 30px;
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
      }

      .stat-card:hover {
        transform: translateY(-10px) scale(1.02);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
      }

      .stat-card::before {
        content: "";
        position: absolute;
        top: -50%;
        right: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(
          45deg,
          transparent,
          rgba(255, 255, 255, 0.1),
          transparent
        );
        transform: rotate(45deg);
        transition: all 0.5s ease;
      }

      .stat-card:hover::before {
        transform: rotate(45deg) translate(50%, 50%);
      }

      .stat-number {
        font-size: 32px;
        font-weight: 700;
        margin-bottom: 10px;
        position: relative;
        z-index: 2;
      }

      .stat-label {
        font-size: 16px;
        opacity: 0.9;
        position: relative;
        z-index: 2;
      }

      .datetime-display {
        background: var(--bg-secondary);
        padding: 25px;
        border-radius: 16px;
        text-align: center;
        margin-bottom: 30px;
        border: 1px solid var(--border-color);
        box-shadow: var(--shadow);
      }

      .time {
        font-size: 36px;
        font-weight: 700;
        color: var(--accent-primary);
        margin-bottom: 5px;
      }

      .date {
        font-size: 18px;
        color: var(--text-secondary);
      }

      .form-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 25px;
      }

      .transaction-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 25px;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: var(--shadow);
      }

      .transaction-table th,
      .transaction-table td {
        padding: 15px 20px;
        text-align: left;
        border-bottom: 1px solid var(--border-color);
        font-size: 15px;
      }

      .transaction-table th {
        background: var(--accent-primary);
        font-weight: 600;
        color: white;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .transaction-table tbody tr {
        transition: all 0.3s ease;
      }

      .transaction-table tbody tr:hover {
        background: var(--bg-secondary);
        transform: scale(1.01);
      }

      .amount-income {
        color: var(--accent-success);
        font-weight: 700;
      }

      .amount-expense {
        color: var(--accent-danger);
        font-weight: 700;
      }

      .chart-container {
        position: relative;
        height: 400px;
        margin: 25px 0;
        background: var(--bg-primary);
        border-radius: 12px;
        padding: 20px;
      }

      .todo-list {
        list-style: none;
        max-height: 400px;
        overflow-y: auto;
      }

      .todo-item {
        display: flex;
        align-items: center;
        padding: 15px 0;
        border-bottom: 1px solid var(--border-color);
        transition: all 0.3s ease;
      }

      .todo-item:hover {
        background: var(--bg-primary);
        padding-left: 10px;
        border-radius: 8px;
      }

      .todo-item:last-child {
        border-bottom: none;
      }

      .todo-checkbox {
        margin-right: 15px;
        transform: scale(1.3);
        cursor: pointer;
      }

      .todo-text {
        flex: 1;
        font-size: 16px;
        line-height: 1.4;
      }

      .todo-text.completed {
        text-decoration: line-through;
        opacity: 0.6;
        color: var(--text-secondary);
      }

      .todo-delete {
        background: var(--accent-danger);
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 12px;
        transition: all 0.3s ease;
      }

      .todo-delete:hover {
        background: #c82333;
        transform: scale(1.1);
      }

      .progress-bar {
        width: 100%;
        height: 24px;
        background: var(--border-color);
        border-radius: 12px;
        overflow: hidden;
        margin: 15px 0;
        position: relative;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(
          90deg,
          var(--accent-success),
          var(--accent-primary)
        );
        border-radius: 12px;
        transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
      }

      .progress-fill::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        bottom: 0;
        right: 0;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.3),
          transparent
        );
        animation: shimmer 2s infinite;
      }

      @keyframes shimmer {
        0% {
          transform: translateX(-100%);
        }
        100% {
          transform: translateX(100%);
        }
      }

      .chat-container {
        max-width: 100%;
        height: 500px;
        border: 1px solid var(--border-color);
        border-radius: 16px;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        box-shadow: var(--shadow);
      }

      .chat-messages {
        flex: 1;
        overflow-y: auto;
        padding: 25px;
        background: var(--bg-primary);
      }

      .chat-message {
        margin-bottom: 20px;
        padding: 12px 18px;
        border-radius: 16px;
        max-width: 75%;
        word-wrap: break-word;
        animation: messageSlide 0.3s ease-out;
      }

      @keyframes messageSlide {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .chat-message.user {
        background: linear-gradient(135deg, var(--accent-primary), #0056b3);
        color: white;
        margin-left: auto;
        border-bottom-right-radius: 4px;
      }

      .chat-message.bot {
        background: var(--bg-secondary);
        color: var(--text-primary);
        border: 1px solid var(--border-color);
        border-bottom-left-radius: 4px;
      }

      .chat-input-container {
        padding: 20px;
        background: var(--bg-secondary);
        border-top: 1px solid var(--border-color);
        display: flex;
        gap: 15px;
      }

      .chat-input {
        flex: 1;
        padding: 12px 18px;
        border: 1px solid var(--border-color);
        border-radius: 25px;
        background: var(--bg-primary);
        color: var(--text-primary);
        outline: none;
        transition: all 0.3s ease;
      }

      .chat-input:focus {
        border-color: var(--accent-primary);
        box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
      }

      /* Export & Share */
      .export-buttons {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin: 25px 0;
      }

      .whatsapp-btn {
        background: linear-gradient(135deg, #25d366, #128c7e);
        color: white;
        text-decoration: none;
        padding: 15px 25px;
        border-radius: 12px;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        font-size: 16px;
      }

      .whatsapp-btn:hover {
        background: linear-gradient(135deg, #128c7e, #0d7a6b);
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(37, 211, 102, 0.3);
      }

      /* Mobile Responsive */
      .mobile-menu-btn {
        display: none;
        background: var(--accent-primary);
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 18px;
      }

      @media (max-width: 768px) {
        .mobile-menu-btn {
          display: block;
        }

        .sidebar {
          transform: translateX(-100%);
          transition: transform 0.3s ease;
          z-index: 1000;
        }

        .sidebar.mobile-open {
          transform: translateX(0);
        }

        .main-content {
          margin-left: 0;
          padding: 20px;
        }

        .header {
          padding: 15px 20px;
        }

        .header-title {
          font-size: 20px;
        }

        .dashboard-grid {
          grid-template-columns: 1fr;
        }

        .form-row {
          grid-template-columns: 1fr;
        }

        .chat-message {
          max-width: 90%;
        }

        .export-buttons {
          grid-template-columns: 1fr;
        }

        .login-card {
          padding: 30px 20px;
          margin: 0 10px;
        }

        .stat-number {
          font-size: 24px;
        }

        .time {
          font-size: 28px;
        }

        .footer {
          padding: 20px;
        }

        .footer-social {
          gap: 10px;
        }

        .social-link {
          padding: 8px 12px;
          font-size: 14px;
        }

        .social-link span {
          display: none;
        }
      }

      /* Loading Spinner */
      .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: #fff;
        animation: spin 1s ease-in-out infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* Notification */
      .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        background: var(--accent-success);
        color: white;
        padding: 15px 25px;
        border-radius: 12px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        animation: slideIn 0.3s ease-out;
      }

      .notification.error {
        background: var(--accent-danger);
      }

      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      /* Scrollbar Styling */
      ::-webkit-scrollbar {
        width: 8px;
      }

      ::-webkit-scrollbar-track {
        background: var(--bg-secondary);
      }

      ::-webkit-scrollbar-thumb {
        background: var(--accent-primary);
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: #0056b3;
      }

      /* Footer Styles */
      .footer {
        background: var(--bg-secondary);
        border-top: 1px solid var(--border-color);
        padding: 30px 40px;
        margin-top: auto;
        text-align: center;
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
      }

      .footer-content {
        max-width: 1200px;
        margin: 0 auto;
      }

      .footer-copyright {
        color: var(--text-secondary);
        font-size: 14px;
        margin-bottom: 20px;
      }

      .footer-social {
        display: flex;
        justify-content: center;
        gap: 20px;
        flex-wrap: wrap;
      }

      .social-link {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        color: var(--text-primary);
        text-decoration: none;
        padding: 10px 15px;
        border-radius: 8px;
        transition: all 0.3s ease;
        background: var(--bg-primary);
        border: 1px solid var(--border-color);
      }

      .social-link:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        color: var(--accent-primary);
      }

      .social-link i {
        font-size: 16px;
      }

      .app-container {
        display: none;
        min-height: 100vh;
        flex-direction: column;
      }

      .main-content {
        margin-left: 280px;
        padding: 40px;
        min-height: calc(100vh - 80px);
        background: var(--bg-primary);
        flex: 1;
      }
    </style>
  </head>
  <body>
    <!-- LOGIN SCREEN -->
    <div id="loginScreen" class="login-container">
      <div class="login-card">
        <div class="logo">üîê</div>
        <h2 class="login-title">Personal Assistant</h2>
        <form id="loginForm">
          <div class="form-group">
            <label for="username">Username:</label>
            <input
              type="text"
              id="username"
              class="form-control"
              required
              placeholder="Masukkan username..."
            />
          </div>
          <div class="form-group">
            <label for="password">Password:</label>
            <input
              type="password"
              id="password"
              class="form-control"
              required
              placeholder="Masukkan password..."
            />
          </div>
          <button type="submit" class="btn btn-primary">
            <span id="loginText">Masuk</span>
            <span
              id="loginLoading"
              class="loading"
              style="display: none"
            ></span>
          </button>
        </form>
        <div id="errorMessage" class="error-message" style="display: none">
          ‚ùå Username atau password salah!<br />
          <small>Gunakan: <strong>admin</strong> / <strong>1234</strong></small>
        </div>
      </div>
    </div>

    <!-- MAIN APP -->
    <div id="appContainer" class="app-container">
      <!-- Header -->
      <header class="header">
        <div class="header-title">üè† Personal Assistant</div>
        <div class="header-controls">
          <button class="mobile-menu-btn" id="mobileMenuBtn">‚ò∞</button>
          <button class="theme-toggle" id="themeToggle">üåô</button>
          <button class="btn btn-danger btn-small" id="logoutBtn">
            Logout
          </button>
        </div>
      </header>

      <!-- Sidebar -->
      <nav class="sidebar" id="sidebar">
        <ul class="sidebar-menu">
          <li>
            <a href="#" data-section="dashboard" class="menu-link active">
              <span class="icon">üìä</span> Dashboard
            </a>
          </li>
          <li>
            <a href="#" data-section="finance" class="menu-link">
              <span class="icon">üí∞</span> Keuangan
            </a>
          </li>
          <li>
            <a href="#" data-section="notes" class="menu-link">
              <span class="icon">üìù</span> Catatan & Todo
            </a>
          </li>
          <li>
            <a href="#" data-section="goals" class="menu-link">
              <span class="icon">üéØ</span> Target
            </a>
          </li>
          <li>
            <a href="#" data-section="chat" class="menu-link">
              <span class="icon">ü§ñ</span> AI Assistant
            </a>
          </li>
          <li>
            <a href="#" data-section="export" class="menu-link">
              <span class="icon">üì§</span> Export & Share
            </a>
          </li>
        </ul>
      </nav>

      <!-- Main Content -->
      <main class="main-content">
        <!-- Dashboard Section -->
        <section id="dashboard" class="content-section active">
          <div class="datetime-display">
            <div class="time" id="currentTime">00:00:00</div>
            <div class="date" id="currentDate">Loading...</div>
          </div>

          <div class="dashboard-grid">
            <div class="stat-card">
              <div class="stat-number" id="totalBalance">Rp 0</div>
              <div class="stat-label">üí∞ Saldo Total</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="totalIncome">Rp 0</div>
              <div class="stat-label">üìà Pemasukan Bulan Ini</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="totalExpense">Rp 0</div>
              <div class="stat-label">üìâ Pengeluaran Bulan Ini</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="todayTodos">0</div>
              <div class="stat-label">‚úÖ Todo Hari Ini</div>
            </div>
          </div>

          <div class="card">
            <h3 class="card-title">üìã Riwayat Transaksi</h3>
            <div style="overflow-x: auto">
              <table class="transaction-table">
                <thead>
                  <tr>
                    <th>Tanggal</th>
                    <th>Jam</th>
                    <th>Keterangan</th>
                    <th>Jumlah</th>
                    <th>Aksi</th>
                  </tr>
                </thead>
                <tbody id="transactionList">
                  <tr>
                    <td
                      colspan="5"
                      style="
                        text-align: center;
                        color: var(--text-secondary);
                        padding: 30px;
                      "
                    >
                      üí° Belum ada transaksi. Tambahkan transaksi pertama Anda!
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <div class="card">
            <h3 class="card-title">üìã Catatan Terbaru</h3>
            <div
              id="recentNotes"
              style="
                min-height: 60px;
                padding: 15px;
                background: var(--bg-primary);
                border-radius: 8px;
                border: 1px solid var(--border-color);
              "
            >
              <em style="color: var(--text-secondary)"
                >üìù Belum ada catatan...</em
              >
            </div>
          </div>

          <div class="card">
            <h3 class="card-title">üéØ Progress Target</h3>
            <div id="goalsSummary" style="min-height: 60px">
              <em style="color: var(--text-secondary)"
                >üéØ Belum ada target...</em
              >
            </div>
          </div>
        </section>

        <!-- Notes & Todos Section -->
        <section id="notes" class="content-section">
          <div class="card">
            <h3 class="card-title">üìù Catatan Harian</h3>
            <div class="form-group">
              <textarea
                id="dailyNotes"
                class="form-control"
                rows="10"
                placeholder="‚úçÔ∏è Tulis catatan harian Anda di sini...

Contoh:
- Hari ini berhasil menyelesaikan proyek
- Perlu beli groceries besok
- Meeting dengan klien jam 2 siang"
              ></textarea>
            </div>
            <button class="btn btn-success" id="saveNotes">
              üíæ Simpan Catatan
            </button>
            <small
              style="
                color: var(--text-secondary);
                margin-top: 10px;
                display: block;
              "
            >
              üí° Catatan akan otomatis tersimpan setiap 30 detik
            </small>
          </div>

          <div class="card">
            <h3 class="card-title">‚úÖ Todo List</h3>
            <form id="todoForm">
              <div class="form-row">
                <div class="form-group">
                  <input
                    type="text"
                    id="todoInput"
                    class="form-control"
                    placeholder="üìù Tambah todo baru... (contoh: Beli susu di minimarket)"
                    required
                  />
                </div>
                <div class="form-group">
                  <button type="submit" class="btn btn-primary">
                    ‚ûï Tambah Todo
                  </button>
                </div>
              </div>
            </form>
            <div style="max-height: 400px; overflow-y: auto">
              <ul id="todoList" class="todo-list">
                <li
                  style="
                    text-align: center;
                    color: var(--text-secondary);
                    padding: 30px;
                  "
                >
                  üí° Belum ada todo. Tambahkan task pertama Anda!
                </li>
              </ul>
            </div>
          </div>
        </section>

        <!-- Goals Section -->
        <section id="goals" class="content-section">
          <div class="card">
            <h3 class="card-title">üéØ Tambah Target Baru</h3>
            <form id="goalForm">
              <div class="form-row">
                <div class="form-group">
                  <label>Nama Target:</label>
                  <input
                    type="text"
                    id="goalName"
                    class="form-control"
                    required
                    placeholder="Contoh: Tabungan Liburan, Belajar Bahasa Inggris..."
                  />
                </div>
                <div class="form-group">
                  <label>Target Angka:</label>
                  <input
                    type="number"
                    id="goalTarget"
                    class="form-control"
                    required
                    min="1"
                    placeholder="Contoh: 5000000 (untuk uang), 30 (untuk hari)"
                  />
                </div>
              </div>
              <button type="submit" class="btn btn-success">
                üéØ Buat Target
              </button>
            </form>
          </div>

          <div class="card">
            <h3 class="card-title">üìä Daftar Target</h3>
            <div id="goalsList">
              <div
                style="
                  text-align: center;
                  color: var(--text-secondary);
                  padding: 30px;
                "
              >
                üí° Belum ada target. Buat target pertama Anda untuk memulai
                tracking progress!
              </div>
            </div>
          </div>
        </section>

        <!-- Finance Section -->
        <section id="finance" class="content-section">
          <div class="card">
            <h3 class="card-title">üí∞ Tambah Transaksi</h3>
            <form id="transactionForm">
              <div class="form-row">
                <div class="form-group">
                  <label>Tipe Transaksi:</label>
                  <select id="transactionType" class="form-control" required>
                    <option value="">-- Pilih Tipe --</option>
                    <option value="income">üìà Pemasukan</option>
                    <option value="expense">üìâ Pengeluaran</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Jumlah (Rupiah):</label>
                  <input
                    type="number"
                    id="transactionAmount"
                    class="form-control"
                    required
                    min="0"
                    step="1000"
                    placeholder="Contoh: 50000"
                  />
                </div>
              </div>
              <div class="form-group">
                <label>Keterangan:</label>
                <input
                  type="text"
                  id="transactionDescription"
                  class="form-control"
                  required
                  placeholder="Contoh: Gaji bulanan, Beli groceries..."
                />
              </div>
              <button type="submit" class="btn btn-success">
                ‚ûï Tambah Transaksi
              </button>
            </form>
          </div>

          <div class="card">
            <h3 class="card-title">üìä Grafik Keuangan</h3>
            <div class="chart-container">
              <canvas id="financeChart"></canvas>
            </div>
          </div>
        </section>

        <!-- AI Chat Section -->
        <section id="chat" class="content-section">
          <div class="card">
            <h3 class="card-title">ü§ñ AI Assistant</h3>
            <div class="chat-container">
              <div class="chat-messages" id="chatMessages">
                <div class="chat-message bot">
                  üëã Halo! Saya AI Assistant Anda.
                  <br /><br />
                  ü§î <strong>Tanya saya tentang:</strong> <br />‚Ä¢ "Berapa saldo
                  saya?" <br />‚Ä¢ "Ada todo apa hari ini?" <br />‚Ä¢ "Bagaimana
                  progress target saya?" <br />‚Ä¢ "Lihat catatan terakhir"
                  <br />‚Ä¢ "Buatkan ringkasan keuangan"
                </div>
              </div>
              <div class="chat-input-container">
                <input
                  type="text"
                  id="chatInput"
                  class="chat-input"
                  placeholder="üí¨ Ketik pesan Anda... (contoh: berapa saldo saya?)"
                />
                <button id="sendMessage" class="btn btn-primary">
                  üì§ Kirim
                </button>
              </div>
            </div>
          </div>
        </section>

        <!-- Export Section -->
        <section id="export" class="content-section">
          <div class="card">
            <h3 class="card-title">üì§ Export & Share</h3>
            <div class="export-buttons">
              <button class="btn btn-success" id="exportExcel">
                üìä Export ke Excel
              </button>
              <button class="btn btn-warning" id="exportWord">
                üìÑ Export ke Word
              </button>
              <a href="#" class="whatsapp-btn" id="shareWhatsApp">
                üì± Share ke WhatsApp
              </a>
            </div>
            <div
              style="
                background: var(--bg-primary);
                padding: 20px;
                border-radius: 12px;
                margin-top: 20px;
                border: 1px solid var(--border-color);
              "
            >
              <h4 style="margin-bottom: 15px; color: var(--accent-primary)">
                üìã Keterangan Export:
              </h4>
              <p style="margin-bottom: 10px">
                <strong>üìä Excel:</strong> Berisi semua data transaksi +
                ringkasan keuangan
              </p>
              <p style="margin-bottom: 10px">
                <strong>üìÑ Word:</strong> Berisi semua catatan harian dalam
                format dokumen
              </p>
              <p>
                <strong>üì± WhatsApp:</strong> Ringkasan singkat saldo, todo, dan
                catatan untuk dibagikan
              </p>
            </div>
          </div>
        </section>
      </main>

      <!-- Footer -->
      <footer class="footer">
        <div class="footer-content">
          <div class="footer-copyright">¬© 2025 - Milik Joewats Soedewo</div>
          <div class="footer-social">
            <a
              href="mailto:joewats@gmail.com"
              class="social-link"
              title="Email"
            >
              <i class="fas fa-envelope"></i>
              <span>Gmail</span>
            </a>
            <a
              href="https://instagram.com/joewats"
              target="_blank"
              class="social-link"
              title="Instagram"
            >
              <i class="fab fa-instagram"></i>
              <span>Instagram</span>
            </a>
            <a
              href="https://twitter.com/joewats"
              target="_blank"
              class="social-link"
              title="Twitter"
            >
              <i class="fab fa-twitter"></i>
              <span>Twitter</span>
            </a>
            <a
              href="https://tiktok.com/@joewats"
              target="_blank"
              class="social-link"
              title="TikTok"
            >
              <i class="fab fa-tiktok"></i>
              <span>TikTok</span>
            </a>
          </div>
        </div>
      </footer>
    </div>

    <script>
      // ===================
      // UTILITY FUNCTIONS
      // ===================
      function showNotification(message, type = "success") {
        const notification = document.createElement("div");
        notification.className = `notification ${
          type === "error" ? "error" : ""
        }`;
        notification.textContent = message;
        document.body.appendChild(notification);

        setTimeout(() => {
          notification.remove();
        }, 3000);
      }

      function formatRupiah(amount) {
        try {
          if (typeof amount !== "number" || isNaN(amount)) {
            return "Rp 0";
          }
          return new Intl.NumberFormat("id-ID", {
            style: "currency",
            currency: "IDR",
            minimumFractionDigits: 0,
            maximumFractionDigits: 0,
          }).format(amount);
        } catch (error) {
          try {
            return `Rp ${amount.toLocaleString("id-ID")}`;
          } catch (e) {
            return `Rp ${amount}`;
          }
        }
      }

      function safeParseInt(value, defaultValue = 0) {
        try {
          if (value === null || value === undefined || value === "") {
            return defaultValue;
          }
          const parsed = parseInt(value);
          return isNaN(parsed) ? defaultValue : parsed;
        } catch (error) {
          return defaultValue;
        }
      }

      function getCurrentMonth() {
        try {
          const now = new Date();
          return `${now.getFullYear()}-${(now.getMonth() + 1)
            .toString()
            .padStart(2, "0")}`;
        } catch (error) {
          return "2025-01";
        }
      }

      function isCurrentMonth(dateString) {
        try {
          if (!dateString || typeof dateString !== "string") {
            return false;
          }
          const [day, month, year] = dateString.split("/");
          if (!day || !month || !year) {
            return false;
          }
          const itemDate = `${year}-${month.padStart(2, "0")}`;
          return itemDate === getCurrentMonth();
        } catch (error) {
          return false;
        }
      }

      // ===================
      // DATA STORAGE
      // ===================
      class DataManager {
        static get(key) {
          try {
            if (typeof Storage === "undefined") {
              return null;
            }
            const data = localStorage.getItem(key);
            return data ? JSON.parse(data) : null;
          } catch (error) {
            console.error("Error loading data:", error);
            return null;
          }
        }

        static set(key, value) {
          try {
            if (typeof Storage === "undefined") {
              return false;
            }
            localStorage.setItem(key, JSON.stringify(value));
            return true;
          } catch (error) {
            console.error("Error saving data:", error);
            showNotification("Error menyimpan data!", "error");
            return false;
          }
        }

        static getTransactions() {
          const data = this.get("transactions");
          return Array.isArray(data) ? data : [];
        }

        static getTodos() {
          const data = this.get("todos");
          return Array.isArray(data) ? data : [];
        }

        static getGoals() {
          const data = this.get("goals");
          return Array.isArray(data) ? data : [];
        }

        static getNotes() {
          const data = this.get("notes");
          return typeof data === "string" ? data : "";
        }
      }

      // ===================
      // LOGIN SYSTEM
      // ===================
      class LoginManager {
        static init() {
          const loginForm = document.getElementById("loginForm");
          const errorMessage = document.getElementById("errorMessage");
          const loginText = document.getElementById("loginText");
          const loginLoading = document.getElementById("loginLoading");

          if (!loginForm) {
            console.warn("Login form not found");
            return;
          }

          loginForm.addEventListener("submit", (e) => {
            e.preventDefault();

            const usernameEl = document.getElementById("username");
            const passwordEl = document.getElementById("password");

            if (!usernameEl || !passwordEl) {
              console.error("Username or password input not found");
              return;
            }

            const username = usernameEl.value.trim();
            const password = passwordEl.value;

            // Show loading
            if (loginText) loginText.style.display = "none";
            if (loginLoading) loginLoading.style.display = "inline-block";
            if (errorMessage) errorMessage.style.display = "none";

            // Simulate loading for better UX
            setTimeout(() => {
              if (username === "admin" && password === "1234") {
                const loginScreen = document.getElementById("loginScreen");
                const appContainer = document.getElementById("appContainer");

                if (loginScreen) loginScreen.style.display = "none";
                if (appContainer) appContainer.style.display = "block";

                App.init();
                showNotification("‚úÖ Login berhasil! Selamat datang!");
              } else {
                if (errorMessage) errorMessage.style.display = "block";
                if (loginText) loginText.style.display = "inline";
                if (loginLoading) loginLoading.style.display = "none";

                // Auto hide error after 5 seconds
                setTimeout(() => {
                  if (errorMessage) errorMessage.style.display = "none";
                }, 5000);
              }
            }, 1000);
          });

          // Auto-fill for demo (remove in production)
          document.addEventListener("keydown", (e) => {
            if (e.ctrlKey && e.key === "l") {
              e.preventDefault();
              const usernameEl = document.getElementById("username");
              const passwordEl = document.getElementById("password");

              if (usernameEl) usernameEl.value = "admin";
              if (passwordEl) passwordEl.value = "1234";
            }
          });
        }
      }

      // ===================
      // MAIN APP
      // ===================
      class App {
        static financeChart = null;

        static init() {
          try {
            this.initNavigation();
            this.initTheme();
            this.initDateTime();
            this.initFinance();
            this.initNotes();
            this.initTodos();
            this.initGoals();
            this.initChat();
            this.initExport();
            this.updateDashboard();
            this.initMobileMenu();

            // Auto-update dashboard every 30 seconds
            setInterval(() => {
              try {
                this.updateDashboard();
              } catch (error) {
                console.warn("Dashboard update failed:", error);
              }
            }, 30000);

            showNotification("üéâ Aplikasi berhasil dimuat!");
          } catch (error) {
            console.error("Error initializing app:", error);
            showNotification("‚ùå Error memuat aplikasi!", "error");
          }
        }

        static initNavigation() {
          const menuLinks = document.querySelectorAll(".menu-link");
          const sections = document.querySelectorAll(".content-section");

          if (menuLinks.length === 0) {
            console.warn("No menu links found");
            return;
          }

          menuLinks.forEach((link) => {
            link.addEventListener("click", (e) => {
              e.preventDefault();
              const targetSection = link.dataset.section;

              if (!targetSection) return;

              // Update active menu
              menuLinks.forEach((l) => l.classList.remove("active"));
              link.classList.add("active");

              // Show target section
              sections.forEach((section) => {
                section.classList.remove("active");
              });

              const targetElement = document.getElementById(targetSection);
              if (targetElement) {
                targetElement.classList.add("active");
              }

              // Close mobile menu
              const sidebar = document.getElementById("sidebar");
              if (sidebar) sidebar.classList.remove("mobile-open");
            });
          });

          // Logout
          const logoutBtn = document.getElementById("logoutBtn");
          if (logoutBtn) {
            logoutBtn.addEventListener("click", () => {
              if (window.confirm("ü§î Yakin ingin logout?")) {
                const appContainer = document.getElementById("appContainer");
                const loginScreen = document.getElementById("loginScreen");
                const usernameEl = document.getElementById("username");
                const passwordEl = document.getElementById("password");
                const loginText = document.getElementById("loginText");
                const loginLoading = document.getElementById("loginLoading");

                if (appContainer) appContainer.style.display = "none";
                if (loginScreen) loginScreen.style.display = "flex";
                if (usernameEl) usernameEl.value = "";
                if (passwordEl) passwordEl.value = "";

                // Reset login button state
                if (loginText) loginText.style.display = "inline";
                if (loginLoading) loginLoading.style.display = "none";

                showNotification("üëã Logout berhasil!");
              }
            });
          }
        }

        static initMobileMenu() {
          const mobileMenuBtn = document.getElementById("mobileMenuBtn");
          if (mobileMenuBtn) {
            mobileMenuBtn.addEventListener("click", () => {
              const sidebar = document.getElementById("sidebar");
              if (sidebar) sidebar.classList.toggle("mobile-open");
            });
          }

          // Close mobile menu when clicking outside
          document.addEventListener("click", (e) => {
            const sidebar = document.getElementById("sidebar");
            const mobileBtn = document.getElementById("mobileMenuBtn");

            if (
              sidebar &&
              mobileBtn &&
              !sidebar.contains(e.target) &&
              !mobileBtn.contains(e.target)
            ) {
              sidebar.classList.remove("mobile-open");
            }
          });
        }

        static initTheme() {
          const themeToggle = document.getElementById("themeToggle");
          if (!themeToggle) {
            console.warn("Theme toggle button not found");
            return;
          }

          const currentTheme = localStorage.getItem("theme") || "light";

          document.documentElement.setAttribute("data-theme", currentTheme);
          themeToggle.textContent = currentTheme === "dark" ? "‚òÄÔ∏è" : "üåô";

          themeToggle.addEventListener("click", () => {
            const theme = document.documentElement.getAttribute("data-theme");
            const newTheme = theme === "dark" ? "light" : "dark";

            document.documentElement.setAttribute("data-theme", newTheme);
            localStorage.setItem("theme", newTheme);
            themeToggle.textContent = newTheme === "dark" ? "‚òÄÔ∏è" : "üåô";

            showNotification(
              `üé® Mode ${newTheme === "dark" ? "gelap" : "terang"} diaktifkan!`
            );
          });
        }

        static initDateTime() {
          const updateTime = () => {
            try {
              const now = new Date();
              const timeString = now.toLocaleTimeString("id-ID");
              const dateString = now.toLocaleDateString("id-ID", {
                weekday: "long",
                year: "numeric",
                month: "long",
                day: "numeric",
              });

              const currentTimeEl = document.getElementById("currentTime");
              const currentDateEl = document.getElementById("currentDate");

              if (currentTimeEl) currentTimeEl.textContent = timeString;
              if (currentDateEl) currentDateEl.textContent = dateString;
            } catch (error) {
              console.error("Error updating time:", error);
            }
          };

          updateTime();
          setInterval(updateTime, 1000);
        }

        static initFinance() {
          const transactionForm = document.getElementById("transactionForm");

          if (!transactionForm) {
            console.warn("Transaction form not found");
            return;
          }

          transactionForm.addEventListener("submit", (e) => {
            e.preventDefault();

            try {
              const typeEl = document.getElementById("transactionType");
              const amountEl = document.getElementById("transactionAmount");
              const descriptionEl = document.getElementById(
                "transactionDescription"
              );

              if (!typeEl || !amountEl || !descriptionEl) {
                showNotification("‚ùå Form transaksi tidak lengkap!", "error");
                return;
              }

              const type = typeEl.value;
              const amount = safeParseInt(amountEl.value);
              const description = descriptionEl.value.trim();

              if (!type || amount <= 0 || !description) {
                showNotification(
                  "‚ùå Mohon isi semua field dengan benar!",
                  "error"
                );
                return;
              }

              const transaction = {
                id: Date.now(),
                type,
                amount,
                description,
                date: new Date().toLocaleDateString("id-ID"),
                time: new Date().toLocaleTimeString("id-ID"),
              };

              const transactions = DataManager.getTransactions();
              transactions.unshift(transaction);

              if (DataManager.set("transactions", transactions)) {
                this.renderTransactions();
                this.updateFinanceChart();
                this.updateDashboard();
                transactionForm.reset();

                const typeText =
                  type === "income" ? "Pemasukan" : "Pengeluaran";
                showNotification(
                  `‚úÖ ${typeText} ${formatRupiah(amount)} berhasil ditambahkan!`
                );
              }
            } catch (error) {
              console.error("Error adding transaction:", error);
              showNotification("‚ùå Error menambah transaksi!", "error");
            }
          });

          this.renderTransactions();
          this.updateFinanceChart();
        }

        static renderTransactions() {
          try {
            const transactions = DataManager.getTransactions();
            const tbody = document.getElementById("transactionList");

            if (!tbody) {
              console.warn("Transaction list table body not found");
              return;
            }

            if (!Array.isArray(transactions) || transactions.length === 0) {
              tbody.innerHTML = `
                            <tr>
                                <td colspan="5" style="text-align: center; color: var(--text-secondary); padding: 30px;">
                                    üí° Belum ada transaksi. Tambahkan transaksi pertama Anda!
                                </td>
                            </tr>
                        `;
              return;
            }

            tbody.innerHTML = transactions
              .map((transaction) => {
                if (
                  !transaction ||
                  !transaction.id ||
                  !transaction.type ||
                  !transaction.amount ||
                  !transaction.description
                ) {
                  return "";
                }
                return `
                            <tr>
                                <td>${transaction.date || ""}</td>
                                <td>${transaction.time || ""}</td>
                                <td>${transaction.description}</td>
                                <td class="amount-${transaction.type}">
                                    ${
                                      transaction.type === "income" ? "+" : "-"
                                    } ${formatRupiah(transaction.amount)}
                                </td>
                                <td>
                                    <button class="btn btn-danger btn-small" onclick="App.deleteTransaction(${
                                      transaction.id
                                    })" title="Hapus transaksi">
                                        üóëÔ∏è
                                    </button>
                                </td>
                            </tr>
                        `;
              })
              .filter((row) => row)
              .join("");
          } catch (error) {
            console.error("Error rendering transactions:", error);
          }
        }

        static deleteTransaction(id) {
          try {
            if (!window.confirm("ü§î Yakin ingin menghapus transaksi ini?"))
              return;

            const transactions = DataManager.getTransactions();
            if (!Array.isArray(transactions)) {
              showNotification("‚ùå Data transaksi tidak valid!", "error");
              return;
            }

            const filteredTransactions = transactions.filter(
              (t) => t && t.id !== id
            );

            if (DataManager.set("transactions", filteredTransactions)) {
              this.renderTransactions();
              this.updateFinanceChart();
              this.updateDashboard();
              showNotification("‚úÖ Transaksi berhasil dihapus!");
            }
          } catch (error) {
            console.error("Error deleting transaction:", error);
            showNotification("‚ùå Error menghapus transaksi!", "error");
          }
        }

        static updateFinanceChart() {
          try {
            const ctx = document.getElementById("financeChart");
            if (!ctx) {
              console.warn("Finance chart canvas not found");
              return;
            }

            // Check if Chart.js is available
            if (typeof Chart === "undefined") {
              console.warn("Chart.js library not available");
              return;
            }

            const transactions = DataManager.getTransactions();

            // Destroy existing chart if exists
            if (this.financeChart) {
              this.financeChart.destroy();
            }

            if (!Array.isArray(transactions)) {
              console.warn("Transactions data is not an array");
              return;
            }

            const currentMonthTransactions = transactions.filter(
              (t) => t && t.date && isCurrentMonth(t.date)
            );
            const income = currentMonthTransactions
              .filter((t) => t.type === "income")
              .reduce((sum, t) => sum + (t.amount || 0), 0);
            const expense = currentMonthTransactions
              .filter((t) => t.type === "expense")
              .reduce((sum, t) => sum + (t.amount || 0), 0);

            this.financeChart = new Chart(ctx, {
              type: "doughnut",
              data: {
                labels: ["üí∞ Pemasukan", "üí∏ Pengeluaran"],
                datasets: [
                  {
                    data: [income, expense],
                    backgroundColor: ["#28a745", "#dc3545"],
                    borderWidth: 3,
                    borderColor: "#ffffff",
                    hoverBorderWidth: 5,
                  },
                ],
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                  legend: {
                    position: "bottom",
                    labels: {
                      padding: 25,
                      usePointStyle: true,
                      font: {
                        size: 14,
                      },
                    },
                  },
                  tooltip: {
                    callbacks: {
                      label: function (context) {
                        const value = formatRupiah(context.raw);
                        return `${context.label}: ${value}`;
                      },
                    },
                  },
                },
              },
            });
          } catch (error) {
            console.error("Error updating chart:", error);
          }
        }

        static initNotes() {
          try {
            const saveNotesBtn = document.getElementById("saveNotes");
            const dailyNotes = document.getElementById("dailyNotes");

            if (!saveNotesBtn || !dailyNotes) {
              console.warn("Notes elements not found");
              return;
            }

            // Load saved notes
            dailyNotes.value = DataManager.getNotes();

            saveNotesBtn.addEventListener("click", () => {
              if (DataManager.set("notes", dailyNotes.value)) {
                showNotification("‚úÖ Catatan berhasil disimpan!");
                this.updateDashboard();
              }
            });

            // Auto-save setiap 30 detik
            setInterval(() => {
              try {
                const currentNotes = DataManager.getNotes();
                if (dailyNotes.value !== currentNotes) {
                  DataManager.set("notes", dailyNotes.value);
                }
              } catch (error) {
                console.warn("Auto-save notes failed:", error);
              }
            }, 30000);
          } catch (error) {
            console.error("Error initializing notes:", error);
          }
        }

        static initTodos() {
          try {
            const todoForm = document.getElementById("todoForm");
            const todoInput = document.getElementById("todoInput");

            if (!todoForm || !todoInput) {
              console.warn("Todo form elements not found");
              return;
            }

            todoForm.addEventListener("submit", (e) => {
              e.preventDefault();
              const text = todoInput.value.trim();

              if (!text) {
                showNotification("‚ùå Todo tidak boleh kosong!", "error");
                return;
              }

              const todo = {
                id: Date.now(),
                text,
                completed: false,
                date: new Date().toLocaleDateString("id-ID"),
              };

              const todos = DataManager.getTodos();
              if (!Array.isArray(todos)) {
                console.error("Todos data is not an array");
                return;
              }

              todos.unshift(todo);

              if (DataManager.set("todos", todos)) {
                this.renderTodos();
                this.updateDashboard();
                todoInput.value = "";
                showNotification("‚úÖ Todo berhasil ditambahkan!");
              }
            });

            this.renderTodos();
          } catch (error) {
            console.error("Error initializing todos:", error);
          }
        }

        static renderTodos() {
          try {
            const todos = DataManager.getTodos();
            const todoList = document.getElementById("todoList");

            if (!todoList) {
              console.warn("Todo list element not found");
              return;
            }

            if (!Array.isArray(todos) || todos.length === 0) {
              todoList.innerHTML = `
                            <li style="text-align: center; color: var(--text-secondary); padding: 30px;">
                                üí° Belum ada todo. Tambahkan task pertama Anda!
                            </li>
                        `;
              return;
            }

            todoList.innerHTML = todos
              .map((todo) => {
                if (!todo || !todo.id || !todo.text) {
                  return "";
                }
                return `
                            <li class="todo-item">
                                <input type="checkbox" class="todo-checkbox" ${
                                  todo.completed ? "checked" : ""
                                } 
                                       onchange="App.toggleTodo(${
                                         todo.id
                                       })" title="Tandai selesai">
                                <span class="todo-text ${
                                  todo.completed ? "completed" : ""
                                }">${todo.text}</span>
                                <button class="todo-delete" onclick="App.deleteTodo(${
                                  todo.id
                                })" title="Hapus todo">üóëÔ∏è</button>
                            </li>
                        `;
              })
              .filter((row) => row)
              .join("");
          } catch (error) {
            console.error("Error rendering todos:", error);
          }
        }

        static toggleTodo(id) {
          try {
            const todos = DataManager.getTodos();
            if (!Array.isArray(todos)) {
              showNotification("‚ùå Data todo tidak valid!", "error");
              return;
            }

            const updatedTodos = todos.map((todo) =>
              todo && todo.id === id
                ? { ...todo, completed: !todo.completed }
                : todo
            );

            if (DataManager.set("todos", updatedTodos)) {
              this.renderTodos();
              this.updateDashboard();

              const todo = updatedTodos.find((t) => t && t.id === id);
              if (todo) {
                const status = todo.completed ? "selesai" : "belum selesai";
                showNotification(`‚úÖ Todo ditandai ${status}!`);
              }
            }
          } catch (error) {
            console.error("Error toggling todo:", error);
            showNotification("‚ùå Error mengubah status todo!", "error");
          }
        }

        static deleteTodo(id) {
          try {
            if (!window.confirm("ü§î Yakin ingin menghapus todo ini?")) return;

            const todos = DataManager.getTodos();
            if (!Array.isArray(todos)) {
              showNotification("‚ùå Data todo tidak valid!", "error");
              return;
            }

            const filteredTodos = todos.filter((t) => t && t.id !== id);

            if (DataManager.set("todos", filteredTodos)) {
              this.renderTodos();
              this.updateDashboard();
              showNotification("‚úÖ Todo berhasil dihapus!");
            }
          } catch (error) {
            console.error("Error deleting todo:", error);
            showNotification("‚ùå Error menghapus todo!", "error");
          }
        }

        static initGoals() {
          try {
            const goalForm = document.getElementById("goalForm");

            if (!goalForm) {
              console.warn("Goal form not found");
              return;
            }

            goalForm.addEventListener("submit", (e) => {
              e.preventDefault();

              const nameEl = document.getElementById("goalName");
              const targetEl = document.getElementById("goalTarget");

              if (!nameEl || !targetEl) {
                showNotification("‚ùå Form target tidak lengkap!", "error");
                return;
              }

              const name = nameEl.value.trim();
              const target = safeParseInt(targetEl.value);

              if (!name || target <= 0) {
                showNotification(
                  "‚ùå Mohon isi nama target dan angka target dengan benar!",
                  "error"
                );
                return;
              }

              const goal = {
                id: Date.now(),
                name,
                target,
                current: 0,
                date: new Date().toLocaleDateString("id-ID"),
              };

              const goals = DataManager.getGoals();
              if (!Array.isArray(goals)) {
                console.error("Goals data is not an array");
                return;
              }

              goals.unshift(goal);

              if (DataManager.set("goals", goals)) {
                this.renderGoals();
                this.updateDashboard();
                goalForm.reset();
                showNotification(`‚úÖ Target "${name}" berhasil dibuat!`);
              }
            });

            this.renderGoals();
          } catch (error) {
            console.error("Error initializing goals:", error);
          }
        }

        static renderGoals() {
          try {
            const goals = DataManager.getGoals();
            const goalsList = document.getElementById("goalsList");

            if (!goalsList) {
              console.warn("Goals list element not found");
              return;
            }

            if (!Array.isArray(goals) || goals.length === 0) {
              goalsList.innerHTML = `
                            <div style="text-align: center; color: var(--text-secondary); padding: 30px;">
                                üí° Belum ada target. Buat target pertama Anda untuk memulai tracking progress!
                            </div>
                        `;
              return;
            }

            goalsList.innerHTML = goals
              .map((goal) => {
                if (
                  !goal ||
                  !goal.id ||
                  !goal.name ||
                  typeof goal.target !== "number" ||
                  typeof goal.current !== "number"
                ) {
                  return "";
                }

                const percentage = Math.min(
                  (goal.current / goal.target) * 100,
                  100
                );
                const isCompleted = goal.current >= goal.target;

                return `
                            <div class="card" style="margin-bottom: 20px; ${
                              isCompleted
                                ? "border: 2px solid var(--accent-success);"
                                : ""
                            }">
                                <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 15px;">
                                    <h4 style="margin: 0; flex: 1;">${
                                      isCompleted ? "‚úÖ" : "üéØ"
                                    } ${goal.name}</h4>
                                    <span style="font-size: 14px; color: var(--text-secondary);">${
                                      goal.date || ""
                                    }</span>
                                </div>
                                <p style="margin: 10px 0; color: var(--text-secondary);">
                                    Target: <strong>${goal.target.toLocaleString(
                                      "id-ID"
                                    )}</strong> | 
                                    Saat ini: <strong>${goal.current.toLocaleString(
                                      "id-ID"
                                    )}</strong>
                                </p>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${percentage}%"></div>
                                </div>
                                <p style="font-size: 14px; color: ${
                                  isCompleted
                                    ? "var(--accent-success)"
                                    : "var(--text-secondary)"
                                }; margin: 10px 0;">
                                    ${
                                      isCompleted
                                        ? "üéâ Target tercapai!"
                                        : `${percentage.toFixed(1)}% tercapai`
                                    }
                                </p>
                                <div style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                                    <button class="btn btn-primary btn-small" onclick="App.updateGoalProgress(${
                                      goal.id
                                    })" title="Update progress">
                                        üìà Update Progress
                                    </button>
                                    <button class="btn btn-danger btn-small" onclick="App.deleteGoal(${
                                      goal.id
                                    })" title="Hapus target">
                                        üóëÔ∏è Hapus
                                    </button>
                                </div>
                            </div>
                        `;
              })
              .filter((row) => row)
              .join("");
          } catch (error) {
            console.error("Error rendering goals:", error);
          }
        }

        static updateGoalProgress(id) {
          try {
            const goals = DataManager.getGoals();
            if (!Array.isArray(goals)) {
              showNotification("‚ùå Data target tidak valid!", "error");
              return;
            }

            const goal = goals.find((g) => g && g.id === id);

            if (!goal) {
              showNotification("‚ùå Target tidak ditemukan!", "error");
              return;
            }

            // Create a simple input dialog
            const newProgress = window.prompt(
              `üéØ Update progress untuk "${goal.name}"\n\n` +
                `Target: ${goal.target.toLocaleString("id-ID")}\n` +
                `Progress saat ini: ${goal.current.toLocaleString(
                  "id-ID"
                )}\n\n` +
                `Masukkan progress baru:`,
              goal.current
            );

            if (newProgress === null || newProgress === "") return;

            const progress = safeParseInt(newProgress);
            if (progress < 0) {
              showNotification("‚ùå Progress tidak boleh negatif!", "error");
              return;
            }

            goal.current = progress;

            if (DataManager.set("goals", goals)) {
              this.renderGoals();
              this.updateDashboard();

              const percentage = (progress / goal.target) * 100;
              if (progress >= goal.target) {
                showNotification(
                  `üéâ Selamat! Target "${goal.name}" sudah tercapai!`
                );
              } else {
                showNotification(
                  `‚úÖ Progress "${
                    goal.name
                  }" diperbarui ke ${percentage.toFixed(1)}%!`
                );
              }
            }
          } catch (error) {
            console.error("Error updating goal progress:", error);
            showNotification("‚ùå Error mengupdate progress!", "error");
          }
        }

        static deleteGoal(id) {
          try {
            if (!window.confirm("ü§î Yakin ingin menghapus target ini?")) return;

            const goals = DataManager.getGoals();
            if (!Array.isArray(goals)) {
              showNotification("‚ùå Data target tidak valid!", "error");
              return;
            }

            const filteredGoals = goals.filter((g) => g && g.id !== id);

            if (DataManager.set("goals", filteredGoals)) {
              this.renderGoals();
              this.updateDashboard();
              showNotification("‚úÖ Target berhasil dihapus!");
            }
          } catch (error) {
            console.error("Error deleting goal:", error);
            showNotification("‚ùå Error menghapus target!", "error");
          }
        }

        static initChat() {
          try {
            const chatInput = document.getElementById("chatInput");
            const sendBtn = document.getElementById("sendMessage");

            if (!chatInput || !sendBtn) {
              console.warn("Chat elements not found");
              return;
            }

            const sendMessage = () => {
              const message = chatInput.value.trim();
              if (!message) return;

              // Add user message
              this.addChatMessage("user", message);
              chatInput.value = "";

              // Show typing indicator
              this.addChatMessage("bot", "ü§ñ Sedang mengetik...");

              // Process AI response
              setTimeout(() => {
                // Remove typing indicator
                const messages = document.getElementById("chatMessages");
                if (messages && messages.lastElementChild) {
                  messages.removeChild(messages.lastElementChild);
                }

                const response = this.processAIMessage(message);
                this.addChatMessage("bot", response);
              }, 1000 + Math.random() * 1000); // Random delay for realistic feel
            };

            sendBtn.addEventListener("click", sendMessage);
            chatInput.addEventListener("keypress", (e) => {
              if (e.key === "Enter") {
                sendMessage();
              }
            });
          } catch (error) {
            console.error("Error initializing chat:", error);
          }
        }

        static addChatMessage(sender, message) {
          try {
            const chatMessages = document.getElementById("chatMessages");
            if (!chatMessages) {
              console.warn("Chat messages container not found");
              return;
            }

            const messageDiv = document.createElement("div");
            messageDiv.className = `chat-message ${sender}`;
            messageDiv.innerHTML = message.replace(/\n/g, "<br>");

            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
          } catch (error) {
            console.error("Error adding chat message:", error);
          }
        }

        static processAIMessage(message) {
          try {
            const msg = message.toLowerCase();
            const transactions = DataManager.getTransactions();
            const todos = DataManager.getTodos();
            const goals = DataManager.getGoals();
            const notes = DataManager.getNotes();

            // Calculate financial data
            const currentMonthTransactions = Array.isArray(transactions)
              ? transactions.filter(
                  (t) => t && t.date && isCurrentMonth(t.date)
                )
              : [];
            const income = currentMonthTransactions
              .filter((t) => t.type === "income")
              .reduce((sum, t) => sum + (t.amount || 0), 0);
            const expense = currentMonthTransactions
              .filter((t) => t.type === "expense")
              .reduce((sum, t) => sum + (t.amount || 0), 0);
            const balance = income - expense;

            // Balance/Money related queries
            if (
              msg.includes("saldo") ||
              msg.includes("uang") ||
              msg.includes("balance") ||
              msg.includes("duit")
            ) {
              return `üí∞ <strong>Ringkasan Keuangan Anda:</strong><br>
                        ‚Ä¢ Saldo: ${formatRupiah(balance)}<br>
                        ‚Ä¢ Pemasukan bulan ini: ${formatRupiah(income)}<br>
                        ‚Ä¢ Pengeluaran bulan ini: ${formatRupiah(expense)}<br>
                        ‚Ä¢ Total transaksi: ${
                          Array.isArray(transactions) ? transactions.length : 0
                        }<br><br>
                        ${
                          balance > 0
                            ? "‚úÖ Keuangan Anda dalam kondisi baik!"
                            : balance < 0
                            ? "‚ö†Ô∏è Pengeluaran melebihi pemasukan!"
                            : "‚ÑπÔ∏è Saldo Anda seimbang."
                        }`;
            }

            if (
              msg.includes("pemasukan") ||
              msg.includes("income") ||
              msg.includes("penghasilan")
            ) {
              const incomeTransactions = currentMonthTransactions.filter(
                (t) => t && t.type === "income"
              );
              const avgIncome =
                incomeTransactions.length > 0
                  ? income / incomeTransactions.length
                  : 0;
              return `üìà <strong>Data Pemasukan:</strong><br>
                        ‚Ä¢ Total pemasukan bulan ini: ${formatRupiah(income)}<br>
                        ‚Ä¢ Jumlah transaksi pemasukan: ${
                          incomeTransactions.length
                        }<br>
                        ‚Ä¢ Rata-rata per transaksi: ${formatRupiah(
                          avgIncome
                        )}<br><br>
                        ${
                          incomeTransactions.length > 0
                            ? "üí° Pemasukan terakhir: " +
                              (incomeTransactions[0]?.description || "")
                            : ""
                        }`;
            }

            if (
              msg.includes("pengeluaran") ||
              msg.includes("expense") ||
              msg.includes("belanja")
            ) {
              const expenseTransactions = currentMonthTransactions.filter(
                (t) => t.type === "expense"
              );
              const avgExpense =
                expenseTransactions.length > 0
                  ? expense / expenseTransactions.length
                  : 0;
              return `üìâ <strong>Data Pengeluaran:</strong><br>
                        ‚Ä¢ Total pengeluaran bulan ini: ${formatRupiah(
                          expense
                        )}<br>
                        ‚Ä¢ Jumlah transaksi pengeluaran: ${
                          expenseTransactions.length
                        }<br>
                        ‚Ä¢ Rata-rata per transaksi: ${formatRupiah(
                          avgExpense
                        )}<br><br>
                        ${
                          expenseTransactions.length > 0
                            ? "üí° Pengeluaran terakhir: " +
                              (expenseTransactions[0]?.description || "")
                            : ""
                        }`;
            }

            // Todo related queries
            if (
              msg.includes("todo") ||
              msg.includes("tugas") ||
              msg.includes("task")
            ) {
              const todosArray = Array.isArray(todos) ? todos : [];
              const pendingTodos = todosArray.filter((t) => t && !t.completed);
              const completedTodos = todosArray.filter((t) => t && t.completed);
              const todayTodos = todosArray.filter(
                (t) =>
                  t &&
                  t.date === new Date().toLocaleDateString("id-ID") &&
                  !t.completed
              );

              let response = `‚úÖ <strong>Ringkasan Todo:</strong><br>
                        ‚Ä¢ Total todo: ${todosArray.length}<br>
                        ‚Ä¢ Belum selesai: ${pendingTodos.length}<br>
                        ‚Ä¢ Sudah selesai: ${completedTodos.length}<br>
                        ‚Ä¢ Todo hari ini: ${todayTodos.length}<br><br>`;

              if (pendingTodos.length > 0) {
                response += `üìù <strong>Todo yang belum selesai:</strong><br>`;
                pendingTodos.slice(0, 3).forEach((todo, index) => {
                  if (todo && todo.text) {
                    response += `${index + 1}. ${todo.text}<br>`;
                  }
                });
                if (pendingTodos.length > 3) {
                  response += `... dan ${pendingTodos.length - 3} lainnya`;
                }
              } else {
                response += `üéâ Semua todo sudah selesai!`;
              }

              return response;
            }

            // Goals/Target related queries
            if (
              msg.includes("target") ||
              msg.includes("goal") ||
              msg.includes("progress")
            ) {
              const goalsArray = Array.isArray(goals) ? goals : [];
              if (goalsArray.length === 0) {
                return `üéØ <strong>Target:</strong><br>
                            Anda belum memiliki target apapun.<br><br>
                            üí° Silakan buat target baru di menu Target untuk mulai tracking progress Anda!`;
              }

              const completedGoals = goalsArray.filter(
                (g) => g && g.current >= g.target
              );
              const totalProgress =
                goalsArray.reduce(
                  (sum, g) =>
                    sum +
                    (g && g.current && g.target
                      ? (g.current / g.target) * 100
                      : 0),
                  0
                ) / goalsArray.length;

              let response = `üéØ <strong>Ringkasan Target:</strong><br>
                        ‚Ä¢ Total target: ${goalsArray.length}<br>
                        ‚Ä¢ Target tercapai: ${completedGoals.length}<br>
                        ‚Ä¢ Progress keseluruhan: ${totalProgress.toFixed(
                          1
                        )}%<br><br>`;

              response += `üìä <strong>Detail Target:</strong><br>`;
              goalsArray.slice(0, 3).forEach((goal) => {
                if (goal && goal.current && goal.target) {
                  const percentage = (goal.current / goal.target) * 100;
                  const status =
                    percentage >= 100 ? "‚úÖ" : percentage >= 75 ? "üü°" : "üî¥";
                  response += `${status} ${
                    goal.name || "Unnamed"
                  }: ${percentage.toFixed(1)}%<br>`;
                }
              });

              if (goalsArray.length > 3) {
                response += `... dan ${goalsArray.length - 3} target lainnya`;
              }

              return response;
            }

            // Notes related queries
            if (
              msg.includes("catatan") ||
              msg.includes("notes") ||
              msg.includes("note")
            ) {
              const notesText = typeof notes === "string" ? notes : "";
              if (!notesText.trim()) {
                return `üìù <strong>Catatan:</strong><br>
                            Anda belum memiliki catatan apapun.<br><br>
                            üí° Mulai menulis catatan di menu "Catatan & Todo"!`;
              }

              const notePreview =
                notesText.length > 150
                  ? notesText.substring(0, 150) + "..."
                  : notesText;
              return `üìù <strong>Catatan Terakhir:</strong><br><br>
                        "${notePreview}"<br><br>
                        üìä Total karakter: ${notesText.length}`;
            }

            // Today's summary
            if (
              msg.includes("hari ini") ||
              msg.includes("today") ||
              msg.includes("ringkasan")
            ) {
              const today = new Date().toLocaleDateString("id-ID");
              const todayTransactions = Array.isArray(transactions)
                ? transactions.filter((t) => t && t.date === today)
                : [];
              const todayTodos = Array.isArray(todos)
                ? todos.filter((t) => t && t.date === today && !t.completed)
                : [];
              const todayIncome = todayTransactions
                .filter((t) => t && t.type === "income")
                .reduce((sum, t) => sum + (t.amount || 0), 0);
              const todayExpense = todayTransactions
                .filter((t) => t && t.type === "expense")
                .reduce((sum, t) => sum + (t.amount || 0), 0);

              return `üìÖ <strong>Ringkasan Hari Ini (${today}):</strong><br><br>
                        üí∞ <strong>Keuangan:</strong><br>
                        ‚Ä¢ Pemasukan: ${formatRupiah(todayIncome)}<br>
                        ‚Ä¢ Pengeluaran: ${formatRupiah(todayExpense)}<br>
                        ‚Ä¢ Transaksi: ${todayTransactions.length}<br><br>
                        ‚úÖ <strong>Todo:</strong><br>
                        ‚Ä¢ Belum selesai: ${todayTodos.length}<br><br>
                        ${
                          todayTransactions.length > 0 || todayTodos.length > 0
                            ? "üéâ Hari yang produktif!"
                            : "üòä Hari yang santai!"
                        }`;
            }

            // Help/Bantuan
            if (
              msg.includes("bantuan") ||
              msg.includes("help") ||
              msg.includes("apa yang bisa")
            ) {
              return `ü§ñ <strong>Saya bisa membantu Anda dengan:</strong><br><br>
                        üí∞ <strong>Keuangan:</strong><br>
                        ‚Ä¢ "Berapa saldo saya?"<br>
                        ‚Ä¢ "Lihat pemasukan bulan ini"<br>
                        ‚Ä¢ "Data pengeluaran saya"<br><br>
                        ‚úÖ <strong>Todo & Target:</strong><br>
                        ‚Ä¢ "Ada todo apa hari ini?"<br>
                        ‚Ä¢ "Bagaimana progress target saya?"<br><br>
                        üìù <strong>Catatan:</strong><br>
                        ‚Ä¢ "Lihat catatan terakhir"<br><br>
                        üìä <strong>Ringkasan:</strong><br>
                        ‚Ä¢ "Buatkan ringkasan hari ini"<br>
                        ‚Ä¢ "Ringkasan keuangan"<br><br>
                        üí° Tanya saja apa yang ingin Anda ketahui!`;
            }

            // Financial analysis
            if (
              msg.includes("analisa") ||
              msg.includes("analisis") ||
              msg.includes("laporan")
            ) {
              const transactionsArray = Array.isArray(transactions)
                ? transactions
                : [];
              const totalIncome = transactionsArray
                .filter((t) => t && t.type === "income")
                .reduce((sum, t) => sum + (t.amount || 0), 0);
              const totalExpense = transactionsArray
                .filter((t) => t && t.type === "expense")
                .reduce((sum, t) => sum + (t.amount || 0), 0);
              const savingRate =
                totalIncome > 0
                  ? ((totalIncome - totalExpense) / totalIncome) * 100
                  : 0;

              let analysis = `üìä <strong>Analisis Keuangan:</strong><br><br>
                        üí∞ Total pemasukan: ${formatRupiah(totalIncome)}<br>
                        üí∏ Total pengeluaran: ${formatRupiah(totalExpense)}<br>
                        üíé Tingkat tabungan: ${savingRate.toFixed(1)}%<br><br>`;

              if (savingRate >= 20) {
                analysis += `‚úÖ <strong>Excellent!</strong> Tingkat tabungan Anda sangat baik!`;
              } else if (savingRate >= 10) {
                analysis += `üëç <strong>Good!</strong> Tingkat tabungan Anda cukup baik.`;
              } else if (savingRate > 0) {
                analysis += `‚ö†Ô∏è <strong>Fair.</strong> Coba tingkatkan tabungan Anda.`;
              } else {
                analysis += `üö® <strong>Warning!</strong> Pengeluaran melebihi pemasukan!`;
              }

              return analysis;
            }

            // Greetings
            if (
              msg.includes("halo") ||
              msg.includes("hai") ||
              msg.includes("hello") ||
              msg.includes("hi")
            ) {
              const greetings = [
                `üëã Halo! Saya siap membantu Anda mengelola keuangan dan aktivitas harian!`,
                `ü§ñ Hai! Ada yang bisa saya bantu hari ini?`,
                `üòä Hello! Tanya saya tentang saldo, todo, atau target Anda!`,
                `üéâ Halo! Siap membantu Anda mencapai tujuan finansial!`,
              ];
              return greetings[Math.floor(Math.random() * greetings.length)];
            }

            // Default responses for unrecognized queries
            const defaultResponses = [
              `ü§î Maaf, saya belum mengerti pertanyaan Anda.<br><br>üí° Coba tanya tentang:<br>‚Ä¢ "Berapa saldo saya?"<br>‚Ä¢ "Ada todo apa hari ini?"<br>‚Ä¢ "Bagaimana target saya?"`,
              `üòÖ Hmm, saya kurang paham. Bisa dijelaskan lebih detail?<br><br>üí° Saya bisa bantu soal keuangan, todo, target, atau catatan Anda!`,
              `üßê Pertanyaan menarik! Tapi saya belum bisa menjawabnya.<br><br>üí° Coba tanya "bantuan" untuk melihat apa saja yang bisa saya lakukan!`,
              `ü§ñ Saya masih belajar untuk memahami pertanyaan ini.<br><br>üí° Ketik "bantuan" untuk melihat daftar pertanyaan yang bisa saya jawab!`,
            ];

            return defaultResponses[
              Math.floor(Math.random() * defaultResponses.length)
            ];
          } catch (error) {
            console.error("Error processing AI message:", error);
            return `‚ùå Maaf, terjadi error saat memproses pesan Anda. Silakan coba lagi!`;
          }
        }

        static initExport() {
          try {
            document
              .getElementById("exportExcel")
              ?.addEventListener("click", () => {
                this.exportToExcel();
              });

            document
              .getElementById("exportWord")
              ?.addEventListener("click", () => {
                this.exportToWord();
              });

            document
              .getElementById("shareWhatsApp")
              ?.addEventListener("click", (e) => {
                e.preventDefault();
                this.shareToWhatsApp();
              });
          } catch (error) {
            console.error("Error initializing export:", error);
          }
        }

        static exportToExcel() {
          try {
            // Check if XLSX library is available
            if (typeof XLSX === "undefined") {
              showNotification("‚ùå Library Excel tidak tersedia!", "error");
              return;
            }

            const transactions = DataManager.getTransactions();

            if (transactions.length === 0) {
              showNotification(
                "‚ùå Tidak ada data transaksi untuk diekspor!",
                "error"
              );
              return;
            }

            // Transaction data
            const ws_data = [
              ["LAPORAN KEUANGAN PERSONAL ASSISTANT"],
              ["Diekspor pada:", new Date().toLocaleString("id-ID")],
              [""],
              ["Tanggal", "Jam", "Keterangan", "Tipe", "Jumlah (Rp)"],
              ...transactions.map((t) => [
                t.date,
                t.time,
                t.description,
                t.type === "income" ? "Pemasukan" : "Pengeluaran",
                t.amount,
              ]),
            ];

            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet(ws_data);

            // Set column widths
            ws["!cols"] = [
              { width: 12 }, // Tanggal
              { width: 10 }, // Jam
              { width: 30 }, // Keterangan
              { width: 12 }, // Tipe
              { width: 15 }, // Jumlah
            ];

            XLSX.utils.book_append_sheet(wb, ws, "Transaksi");

            // Summary sheet
            const income = transactions
              .filter((t) => t.type === "income")
              .reduce((sum, t) => sum + t.amount, 0);
            const expense = transactions
              .filter((t) => t.type === "expense")
              .reduce((sum, t) => sum + t.amount, 0);
            const balance = income - expense;
            const currentMonthTransactions = transactions.filter((t) =>
              isCurrentMonth(t.date)
            );
            const monthlyIncome = currentMonthTransactions
              .filter((t) => t.type === "income")
              .reduce((sum, t) => sum + t.amount, 0);
            const monthlyExpense = currentMonthTransactions
              .filter((t) => t.type === "expense")
              .reduce((sum, t) => sum + t.amount, 0);

            const summary_data = [
              ["RINGKASAN KEUANGAN"],
              [""],
              ["TOTAL KESELURUHAN:"],
              ["Total Pemasukan", income],
              ["Total Pengeluaran", expense],
              ["Saldo", balance],
              [""],
              ["BULAN INI:"],
              ["Pemasukan Bulan Ini", monthlyIncome],
              ["Pengeluaran Bulan Ini", monthlyExpense],
              ["Saldo Bulan Ini", monthlyIncome - monthlyExpense],
              [""],
              ["STATISTIK:"],
              ["Total Transaksi", transactions.length],
              [
                "Transaksi Pemasukan",
                transactions.filter((t) => t.type === "income").length,
              ],
              [
                "Transaksi Pengeluaran",
                transactions.filter((t) => t.type === "expense").length,
              ],
              [""],
              ["Diekspor pada", new Date().toLocaleString("id-ID")],
            ];

            const ws_summary = XLSX.utils.aoa_to_sheet(summary_data);
            ws_summary["!cols"] = [{ width: 25 }, { width: 15 }];
            XLSX.utils.book_append_sheet(wb, ws_summary, "Ringkasan");

            const filename = `Laporan_Keuangan_${
              new Date().toISOString().split("T")[0]
            }.xlsx`;
            try {
              XLSX.writeFile(wb, filename);
              showNotification("‚úÖ Data berhasil diekspor ke Excel!");
            } catch (error) {
              // Fallback: download as CSV
              const csv = XLSX.utils.sheet_to_csv(ws);
              const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
              const link = document.createElement("a");
              link.href = window.URL.createObjectURL(blob);
              link.download = filename.replace(".xlsx", ".csv");
              link.click();
              setTimeout(() => window.URL.revokeObjectURL(link.href), 100);
              showNotification("‚úÖ Data berhasil diekspor ke CSV!");
            }
          } catch (error) {
            console.error("Error exporting to Excel:", error);
            showNotification(
              "‚ùå Gagal mengekspor ke Excel! Pastikan browser mendukung fitur ini.",
              "error"
            );
          }
        }

        static exportToWord() {
          try {
            const notes = DataManager.getNotes();
            const todos = DataManager.getTodos();
            const goals = DataManager.getGoals();

            if (!notes.trim() && todos.length === 0 && goals.length === 0) {
              showNotification("‚ùå Tidak ada data untuk diekspor!", "error");
              return;
            }

            // Create comprehensive text file
            let content = `LAPORAN PERSONAL ASSISTANT
================================

Diekspor pada: ${new Date().toLocaleString("id-ID")}

`;

            if (notes.trim()) {
              content += `CATATAN HARIAN:
${notes}

`;
            }

            if (todos.length > 0) {
              content += `TODO LIST:
`;
              todos.forEach((todo, index) => {
                const status = todo.completed ? "‚úÖ" : "‚è≥";
                content += `${index + 1}. ${status} ${todo.text} (${todo.date})
`;
              });
              content += `
`;
            }

            if (goals.length > 0) {
              content += `TARGET & PROGRESS:
`;
              goals.forEach((goal, index) => {
                const percentage = ((goal.current / goal.target) * 100).toFixed(
                  1
                );
                const status =
                  goal.current >= goal.target
                    ? "‚úÖ TERCAPAI"
                    : `${percentage}%`;
                content += `${index + 1}. ${goal.name}: ${status}
   Target: ${goal.target.toLocaleString("id-ID")}
   Progress: ${goal.current.toLocaleString("id-ID")}
   Dibuat: ${goal.date}

`;
              });
            }

            content += `---
Dibuat dengan Personal Assistant
¬© 2025 - Milik Joewats Soedewo
`;

            const blob = new Blob([content], {
              type: "text/plain;charset=utf-8",
            });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = `Laporan_Personal_Assistant_${
              new Date().toISOString().split("T")[0]
            }.txt`;
            a.click();
            setTimeout(() => window.URL.revokeObjectURL(url), 100);

            showNotification("‚úÖ Data berhasil diekspor ke file teks!");
          } catch (error) {
            console.error("Error exporting data:", error);
            showNotification("‚ùå Gagal mengekspor data!", "error");
          }
        }

        static shareToWhatsApp() {
          try {
            const transactions = DataManager.getTransactions();
            const todos = DataManager.getTodos();
            const goals = DataManager.getGoals();
            const notes = DataManager.getNotes();

            const currentMonthTransactions = transactions.filter((t) =>
              isCurrentMonth(t.date)
            );
            const income = currentMonthTransactions
              .filter((t) => t.type === "income")
              .reduce((sum, t) => sum + t.amount, 0);
            const expense = currentMonthTransactions
              .filter((t) => t.type === "expense")
              .reduce((sum, t) => sum + t.amount, 0);
            const balance = income - expense;

            const pendingTodos = todos.filter((t) => !t.completed);
            const completedGoals = goals.filter((g) => g.current >= g.target);

            let message = `üìä *RINGKASAN PERSONAL ASSISTANT*

üí∞ *KEUANGAN BULAN INI:*
‚Ä¢ Saldo: ${formatRupiah(balance)}
‚Ä¢ Pemasukan: ${formatRupiah(income)}
‚Ä¢ Pengeluaran: ${formatRupiah(expense)}
‚Ä¢ Transaksi: ${currentMonthTransactions.length}

‚úÖ *TODO & TARGET:*
‚Ä¢ Todo belum selesai: ${pendingTodos.length}
‚Ä¢ Target tercapai: ${completedGoals.length}/${goals.length}`;

            if (pendingTodos.length > 0) {
              message += `\n\nüìù *TODO PENDING:*`;
              pendingTodos.slice(0, 3).forEach((todo, index) => {
                message += `\n${index + 1}. ${todo.text}`;
              });
              if (pendingTodos.length > 3) {
                message += `\n... dan ${pendingTodos.length - 3} lainnya`;
              }
            }

            if (notes.trim()) {
              const notePreview =
                notes.length > 100 ? notes.substring(0, 100) + "..." : notes;
              message += `\n\nüìã *CATATAN TERAKHIR:*\n"${notePreview}"`;
            }

            message += `\n\n---\nüì± Dibuat dengan Personal Assistant\nüïí ${new Date().toLocaleString(
              "id-ID"
            )}`;

            const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(
              message
            )}`;
            try {
              window.open(whatsappUrl, "_blank");
              showNotification("‚úÖ Membuka WhatsApp untuk berbagi ringkasan!");
            } catch (error) {
              // Fallback: copy to clipboard
              if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard
                  .writeText(message)
                  .then(() => {
                    showNotification("‚úÖ Ringkasan disalin ke clipboard!");
                  })
                  .catch(() => {
                    showNotification("‚ùå Gagal membuka WhatsApp!", "error");
                  });
              } else {
                showNotification("‚ùå Gagal membuka WhatsApp!", "error");
              }
            }
          } catch (error) {
            console.error("Error sharing to WhatsApp:", error);
            showNotification("‚ùå Gagal membuka WhatsApp!", "error");
          }
        }

        static updateDashboard() {
          try {
            const transactions = DataManager.getTransactions();
            const todos = DataManager.getTodos();
            const goals = DataManager.getGoals();
            const notes = DataManager.getNotes();

            // Calculate current month financial stats
            const currentMonthTransactions = transactions.filter((t) =>
              isCurrentMonth(t.date)
            );
            const income = currentMonthTransactions
              .filter((t) => t.type === "income")
              .reduce((sum, t) => sum + t.amount, 0);
            const expense = currentMonthTransactions
              .filter((t) => t.type === "expense")
              .reduce((sum, t) => sum + t.amount, 0);
            const balance = income - expense;

            // Update dashboard cards
            const totalBalance = document.getElementById("totalBalance");
            const totalIncome = document.getElementById("totalIncome");
            const totalExpense = document.getElementById("totalExpense");
            const todayTodos = document.getElementById("todayTodos");

            if (totalBalance) totalBalance.textContent = formatRupiah(balance);
            if (totalIncome) totalIncome.textContent = formatRupiah(income);
            if (totalExpense) totalExpense.textContent = formatRupiah(expense);
            if (todayTodos)
              todayTodos.textContent = todos.filter((t) => !t.completed).length;

            // Update recent notes (if element exists)
            const recentNotes = document.getElementById("recentNotes");
            if (recentNotes) {
              if (notes.trim()) {
                const preview =
                  notes.length > 200 ? notes.substring(0, 200) + "..." : notes;
                recentNotes.innerHTML = preview.replace(/\n/g, "<br>");
              } else {
                recentNotes.innerHTML =
                  '<em style="color: var(--text-secondary);">üìù Belum ada catatan...</em>';
              }
            }

            // Update goals summary (if element exists)
            const goalsSummary = document.getElementById("goalsSummary");
            if (goalsSummary) {
              if (goals.length > 0) {
                const completedGoals = goals.filter(
                  (g) => g.current >= g.target
                ).length;
                const totalProgress =
                  goals.reduce(
                    (sum, g) => sum + (g.current / g.target) * 100,
                    0
                  ) / goals.length;

                goalsSummary.innerHTML = `
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; text-align: center;">
                                    <div>
                                        <div style="font-size: 24px; font-weight: 700; color: var(--accent-primary);">${
                                          goals.length
                                        }</div>
                                        <div style="font-size: 14px; color: var(--text-secondary);">Total Target</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 24px; font-weight: 700; color: var(--accent-success);">${completedGoals}</div>
                                        <div style="font-size: 14px; color: var(--text-secondary);">Tercapai</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 24px; font-weight: 700; color: var(--accent-warning);">${totalProgress.toFixed(
                                          0
                                        )}%</div>
                                        <div style="font-size: 14px; color: var(--text-secondary);">Rata-rata Progress</div>
                                    </div>
                                </div>
                            `;
              } else {
                goalsSummary.innerHTML =
                  '<em style="color: var(--text-secondary);">üéØ Belum ada target...</em>';
              }
            }
          } catch (error) {
            console.error("Error updating dashboard:", error);
          }
        }
      }

      // ===================
      // GLOBAL ERROR HANDLER
      // ===================
      window.addEventListener("error", (e) => {
        console.error("Global error:", e.error);
        showNotification("‚ùå Terjadi error yang tidak terduga!", "error");
      });

      window.addEventListener("unhandledrejection", (e) => {
        console.error("Unhandled promise rejection:", e.reason);
        showNotification("‚ùå Terjadi error saat memproses data!", "error");
      });

      // ===================
      // INITIALIZE APP
      // ===================
      document.addEventListener("DOMContentLoaded", () => {
        try {
          // Check browser compatibility
          if (typeof Storage === "undefined") {
            window.alert(
              "‚ö†Ô∏è Browser Anda tidak mendukung localStorage. Beberapa fitur mungkin tidak berfungsi."
            );
          }

          LoginManager.init();

          // Add loading indicator
          const style = document.createElement("style");
          style.textContent = `
                    .loading-overlay {
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background: rgba(0,0,0,0.5);
                        display: flex;
                        justify-content: center;
                        align-items: center;
                        z-index: 9999;
                        backdrop-filter: blur(5px);
                    }
                    .loading-content {
                        background: var(--bg-primary);
                        padding: 30px;
                        border-radius: 15px;
                        text-align: center;
                        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                    }
                `;
          document.head.appendChild(style);
        } catch (error) {
          console.error("Error during initialization:", error);
          window.alert(
            "‚ùå Error saat memuat aplikasi. Silakan refresh halaman."
          );
        }
      });

      // ===================
      // UTILITY FUNCTIONS FOR GLOBAL ACCESS
      // ===================

      // Make functions available globally for onclick handlers
      window.App = App;

      // Add keyboard shortcuts
      document.addEventListener("keydown", (e) => {
        // Ctrl + M: Toggle mobile menu
        if (e.ctrlKey && e.key === "m") {
          e.preventDefault();
          const sidebar = document.getElementById("sidebar");
          sidebar?.classList.toggle("mobile-open");
        }

        // Ctrl + T: Toggle theme
        if (e.ctrlKey && e.key === "t") {
          e.preventDefault();
          document.getElementById("themeToggle")?.click();
        }

        // Escape: Close mobile menu
        if (e.key === "Escape") {
          document.getElementById("sidebar")?.classList.remove("mobile-open");
        }
      });

      // Add touch support for mobile
      let touchStartY = 0;
      document.addEventListener("touchstart", (e) => {
        touchStartY = e.touches[0].clientY;
      });

      document.addEventListener("touchend", (e) => {
        const touchEndY = e.changedTouches[0].clientY;
        const diff = touchStartY - touchEndY;

        // Swipe up to close mobile menu
        if (diff > 50) {
          document.getElementById("sidebar")?.classList.remove("mobile-open");
        }
      });

      // Auto-save functionality for all forms
      setInterval(() => {
        try {
          const forms = document.querySelectorAll("input, textarea, select");
          forms.forEach((form) => {
            if (form.value && form.id && form.type !== "password") {
              localStorage.setItem(`autosave_${form.id}`, form.value);
            }
          });
        } catch (error) {
          console.warn("Auto-save failed:", error);
        }
      }, 60000); // Auto-save every minute

      // Restore form data on page load
      window.addEventListener("load", () => {
        try {
          const forms = document.querySelectorAll("input, textarea, select");
          forms.forEach((form) => {
            if (form.id && form.type !== "password") {
              const saved = localStorage.getItem(`autosave_${form.id}`);
              if (saved && !form.value) {
                form.value = saved;
              }
            }
          });
        } catch (error) {
          console.warn("Form restore failed:", error);
        }
      });

      // Add print styles
      const printStyles = document.createElement("style");
      printStyles.textContent = `
            @media print {
                .header, .sidebar, .mobile-menu-btn, .btn, button {
                    display: none !important;
                }
                .main-content {
                    margin-left: 0 !important;
                }
                .card {
                    break-inside: avoid;
                    box-shadow: none;
                    border: 1px solid #000;
                }
                body {
                    font-size: 12px;
                }
                .chart-container {
                    height: 200px;
                }
            }
        `;
      document.head.appendChild(printStyles);

      // Performance monitoring
      if (
        "performance" in window &&
        "navigation" in performance &&
        performance.navigation &&
        performance.navigation.timing
      ) {
        window.addEventListener("load", () => {
          setTimeout(() => {
            try {
              const loadTime =
                performance.navigation.timing.loadEventEnd -
                performance.navigation.timing.navigationStart;
              console.log(`‚úÖ App loaded in ${loadTime}ms`);
            } catch (error) {
              console.log("‚úÖ App loaded successfully");
            }
          }, 0);
        });
      }

      // Service worker for offline capability (basic)
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          try {
            const swCode = `
                        self.addEventListener('install', function(e) {
                            console.log('SW Install');
                        });
                        self.addEventListener('activate', function(e) {
                            console.log('SW Activate');
                        });
                    `;

            const blob = new Blob([swCode], { type: "application/javascript" });
            const swUrl = window.URL.createObjectURL(blob);

            navigator.serviceWorker
              .register(swUrl)
              .then(() => {
                console.log("‚úÖ Service Worker registered for offline support");
              })
              .catch(() => {
                console.log("‚ùå Service Worker registration failed");
              });
          } catch (error) {
            console.log("‚ùå Service Worker setup failed");
          }
        });
      }

      // Add data validation
      function validateData() {
        try {
          const transactions = DataManager.getTransactions();
          const todos = DataManager.getTodos();
          const goals = DataManager.getGoals();

          // Validate transactions
          if (Array.isArray(transactions)) {
            const validTransactions = transactions.filter(
              (t) =>
                t &&
                t.id &&
                t.type &&
                t.amount &&
                typeof t.amount === "number" &&
                t.description &&
                t.date
            );

            if (validTransactions.length !== transactions.length) {
              console.warn("‚ö†Ô∏è Found invalid transactions, cleaning up...");
              DataManager.set("transactions", validTransactions);
            }
          }

          // Validate todos
          if (Array.isArray(todos)) {
            const validTodos = todos.filter(
              (t) =>
                t &&
                t.id &&
                t.text &&
                typeof t.completed === "boolean" &&
                t.date
            );

            if (validTodos.length !== todos.length) {
              console.warn("‚ö†Ô∏è Found invalid todos, cleaning up...");
              DataManager.set("todos", validTodos);
            }
          }

          // Validate goals
          if (Array.isArray(goals)) {
            const validGoals = goals.filter(
              (g) =>
                g &&
                g.id &&
                g.name &&
                typeof g.target === "number" &&
                typeof g.current === "number" &&
                g.date
            );

            if (validGoals.length !== goals.length) {
              console.warn("‚ö†Ô∏è Found invalid goals, cleaning up...");
              DataManager.set("goals", validGoals);
            }
          }

          return true;
        } catch (error) {
          console.error("‚ùå Data validation failed:", error);
          return false;
        }
      }

      // Run data validation on app start
      setTimeout(() => {
        try {
          validateData();
        } catch (error) {
          console.warn("Data validation failed on startup:", error);
        }
      }, 1000);
    </script>
  </body>
</html>
